<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="">
  <meta name="author" content="">
  <link rel="icon" type="image/png" href="images/favicon.png">
  <title>Outbound item configurations</title>
  <link rel="canonical" href="https://getbootstrap.com/docs/4.0/examples/checkout/">
  <!-- Bootstrap core CSS -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.css" rel="stylesheet">
  <link href="https://cdn.datatables.net/1.10.20/css/dataTables.bootstrap4.min.css" rel="stylesheet">
</head>

<body class="bg-light">
  <main role="main" class="container">
    <div class="py-5 text-center">
      <img class="d-block mx-auto mb-4" src="https://getbootstrap.com/docs/4.0/assets/brand/bootstrap-solid.svg" alt="" width="72" height="72">
      <h2>Outbound item configurations</h2>
      <p class="lead">Manage outbound configurations</p>
    </div>
  </main>
  <div class="container">
    <div class="row pb-4">
      <div class="col-md-12">
        <ul class="nav nav-tabs">
          <li class="nav-item">
            <a class="nav-link" href="index.html">Inventory</a>
          </li>
          <li class="nav-item">
            <a class="nav-link active disabled" href="config.html">Finished products</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="stock.html">Stock</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="outbound.html">Outbound</a>
          </li>
        </ul>
      </div>
    </div>
  </div>
  <div class="container">
      <div id="accordion">
          <div class="card">
              <div class="card-header" id="headingOne">
                  <h5 class="mb-0">
                      <button class="btn btn-link" data-toggle="collapse" data-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
                          Create new finished product
                      </button>
                  </h5>
              </div>

              <div id="collapseOne" class="collapse hide" aria-labelledby="headingOne" data-parent="#accordion">
                  <div class="card-body">
                      <div class="row">
                          <div class="col-md-3">
                              <div class="form-group"> <label for="inputmailh" class="">Product type<br></label>
                                  <select class="form-control custom-select" id="itemType">
                                      <option selected="">Choose one</option>
                                  </select>
                              </div>
                          </div>
                          <div class="col-md-1">
                              <div class="form-group"> <label for="inputpasswordh" class="">Count<br></label>
                                  <input type="number" class="form-control" id="count">
                              </div>
                          </div>
                      </div>
                      <div class="row pb-4">
                          <div class="col-md-12"><button id="add" class="btn btn-secondary">Add to list</button></div>
                      </div>
                      <div class="row">
                          <div class="col-md-12">
                              <table id="items" class="table table-striped table-bordered">
                                  <thead>
                                  <tr>
                                      <th>Name</th>
                                      <th>Count</th>
                                  </tr>
                                  </thead>
                              </table>
                          </div>
                      </div>
                      <hr />
                      <div class="row">
                          <div class="col-md-3">
                              <div class="form-group">
                                  <label for="inputpasswordh" class="">Finished product name<br>
                                  </label>
                                  <input type="text" class="form-control" id="finishedProductName">
                              </div>
                          </div>
                      </div>
                      <div class="row pb-4">
                          <div class="col-md-12"><button id="createNew" class="btn btn-secondary">Save new finished product</button></div>
                      </div>
                  </div>
              </div>
          </div>
      </div>
  </div>

  <div class="container">
      <div class="row pt-3">
          <div class="col-md-12">
              <table id="finishedProducts" class="table table-striped table-bordered">
                  <thead>
                  <tr>
                      <th>Name</th>
                      <th>Count</th>
                  </tr>
                  </thead>
              </table>
          </div>
      </div>
  </div>

  <footer class="my-5 pt-5 text-muted text-center text-small">
    <p class="mb-1">Â© TRUMP 2020</p>
    <ul class="list-inline">
      <li class="list-inline-item"><a href="#">Privacy</a></li>
      <li class="list-inline-item"><a href="#">Terms</a></li>
      <li class="list-inline-item"><a href="#">Support</a></li>
    </ul>
  </footer>
  <!-- Bootstrap core JavaScript -->
  <!-- Placed at the end of the document so the pages load faster -->
  <script src="https://pagecdn.io/lib/jquery/3.4.1/jquery.min.js"></script>
  <script src="https://cdn.datatables.net/1.10.20/js/jquery.dataTables.min.js"></script>
  <script src="https://cdn.datatables.net/1.10.20/js/dataTables.bootstrap4.min.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>

  <script>
    $(document).ready(function() {
        var fpTable = $("#finishedProducts").DataTable({
            ajax: "http://127.0.0.1:8080/outbound/config",
            columns: [{"data": "name"}, {"data": "count", "searchable": false}]
        });

      var items = $('#items').DataTable({
        "columns": [{ "data": "name" }, { "data": "count" }]
      });

      var reloadItemNameList = function() {
          $.ajax({
              type: "GET",
              url: '/inbound/config',
              accept: "application/json",
              success: function (data) {
                  let items = data.data;
                  if (items) {
                      $("#itemType").empty();
                      items.map(function (item) {
                          $("#itemType").append(new Option(item.type));
                      })
                  }
              },
              error: function (resp) {
                  console.log(resp.statusText)
              }
          });
      };

      reloadItemNameList();

      $("#createNew").on('click', function () {
          var tableData = items.rows().data();
          var fpName = $("#finishedProductName").val();
          if (tableData && fpName) {
              var cs = {};
              tableData.each(function (i) {
                  cs[i.name] = Number.parseInt(i.count)
              });
              var payload = {
                  name: fpName,
                  items: cs
              };
              $.ajax({
                  type: "POST",
                  url: '/outbound/config',
                  data: JSON.stringify(payload),
                  contentType: "application/json",
                  success: function() {
                      items.clear().draw();
                      fpTable.ajax.reload();
                      $("#finishedProductName").val('');
                      reloadItemNameList()
                  },
                  error: function(resp) {
                      console.log(resp.statusText)
                  }
              });
          }
      });

      $("#add").on('click', function() {
        let selectedItemName = $("#itemType option:selected");
        var name = selectedItemName.text();
        let itemCount = $("#count");
        var count = itemCount.val();
        if (name && count) {
          items.row.add({
            "name": name,
            "count": count
          }).draw();
          selectedItemName.remove();
          itemCount.val('')
        }
      })
    });
  </script>
</body>

</html>